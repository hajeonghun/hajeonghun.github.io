---
title: CORS(Cross-Origin Resource Sharing) ì´í•´í•˜ê¸° (2)
date: 2025-01-21 16:30:00 +09:00
last_modified_at: 2025-01-21 16:30:00 +09:00
categories: [Browser]
tags:
  [
    CORS,
    SOP,
    Browser
  ]
---

- [CORS(Cross-Origin Resource Sharing) ì´í•´í•˜ê¸° (1)](https://hajeonghun.github.io/posts/CORS-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0-(1)/)

## CORS(Cross-Origin Resource Sharing)
CORS(Cross-Origin Resource Sharing)ëŠ” ë¸Œë¼ìš°ì €ê°€ ë‹¤ë¥¸ ì¶œì²˜(Cross-Origin)ë¡œë¶€í„° ë¦¬ì†ŒìŠ¤ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë„ë¡ ì„œë²„ê°€ í—ˆê°€ í•´ì£¼ëŠ” HTTP í—¤ë” ê¸°ë°˜ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.  
ë‹¤ì‹œë§í•´, SOPì˜ ê¸°ë³¸ ë³´ì•ˆ ì² í•™ì„ ìœ ì§€í•˜ë©´ì„œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ì— í•œí•´ íŠ¹ì • ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•˜ëŠ” ì •ì±…ì…ë‹ˆë‹¤.

![Image](https://github.com/user-attachments/assets/db3e37df-079f-418f-a4f2-2df9fa8573ee)

### CORSë¥¼ ì‚¬ìš©í•˜ëŠ” ìš”ì²­
#### 1. fetch, XMLHttpRequest
- `fetch()`ì™€ `XMLHttpRequest`ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ HTTP ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤.
- SOPì˜ ì˜í–¥ìœ¼ë¡œ ê¸°ë³¸ì ìœ¼ë¡œ ë‹¤ë¥¸ ì¶œì²˜ë¡œ ìš”ì²­ì„ ë³´ë‚´ê±°ë‚˜ ì‘ë‹µ ë°ì´í„°ë¥¼ ì½ëŠ” ê²ƒì€ ì œí•œë©ë‹ˆë‹¤.
- ê·¸ëŸ¬ë‚˜ ì„œë²„ê°€ ì ì ˆí•œ CORS í—¤ë”(`Access-Control-Allow-Origin`)ë¥¼ Response Headerì— í¬í•¨í•˜ë©´ ë‹¤ë¥¸ ì¶œì²˜ì—ì„œë„ ìš”ì²­ê³¼ ì‘ë‹µì„ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 2. ì›¹ í°íŠ¸(Web Fonts)
- CSSì˜ `@font-face` ê·œì¹™ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ì¶œì²˜(Cross-Origin)ì—ì„œ í°íŠ¸ë¥¼ ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- í•˜ì§€ë§Œ êµì°¨ ì¶œì²˜(Cross-Origin)ì—ì„œ í°íŠ¸ë¥¼ ê°€ì ¸ì˜¤ë ¤ë©´ ì„œë²„ì—ì„œ CORS í—¤ë”ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
  - ì˜ˆë¥¼ ë“¤ì–´, `Access-Control-Allow-Origin` í—¤ë”ê°€ ì—†ìœ¼ë©´ ë¸Œë¼ìš°ì €ëŠ” í•´ë‹¹ í°íŠ¸ë¥¼ ë¡œë“œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ì´ ë°©ì‹ì€ íŠ¹ì • ì›¹ì‚¬ì´íŠ¸ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í°íŠ¸ë¥¼ ë³´í˜¸í•˜ëŠ” ë° ìœ ìš©í•©ë‹ˆë‹¤.

#### 3. WebGL í…ìŠ¤ì²˜(WebGL Textures)
- [WebGL](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API){:target="_blank"}ì€ 3D ê·¸ë˜í”½ì„ ë Œë”ë§í•˜ê¸° ìœ„í•œ ë¸Œë¼ìš°ì € APIì…ë‹ˆë‹¤.
- WebGLì—ì„œ ì™¸ë¶€ ì´ë¯¸ì§€ë¥¼ í…ìŠ¤ì²˜ë¡œ ì‚¬ìš©í•˜ë ¤ë©´ í•´ë‹¹ ì´ë¯¸ì§€ê°€ ìˆëŠ” ì„œë²„ì— CORS í—¤ë”ê°€ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
- CORS ì„¤ì •ì´ ì—†ìœ¼ë©´ WebGLì€ ì´ë¯¸ì§€ë¥¼ ë Œë”ë§í•˜ì§€ ëª»í•©ë‹ˆë‹¤.

#### 4. Canvasì—ì„œ ê·¸ë¦° ì´ë¯¸ì§€/ë¹„ë””ì˜¤ í”„ë ˆì„
- HTML `<canvas>` ìš”ì†Œì˜ `drawImage()` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ì´ë¯¸ì§€ë‚˜ ë¹„ë””ì˜¤ë¥¼ ìº”ë²„ìŠ¤ì— ê·¸ë¦´ ë•Œ, ì™¸ë¶€ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì„œë²„ê°€ CORS í—¤ë”ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.
- ë§Œì•½ CORS í—¤ë”ê°€ ì—†ìœ¼ë©´ ìº”ë²„ìŠ¤ì— ì´ë¯¸ì§€ë¥¼ ê·¸ë¦¬ë”ë¼ë„ `toDataURL()` ê°™ì€ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•  ë•Œ **ì˜¤ë¥˜**ê°€ ë°œìƒí•˜ì—¬ ë°ì´í„°ë¥¼ ì¶”ì¶œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
  - ì´ëŠ” ë³´ì•ˆìƒì˜ ì´ìœ ë¡œ, ì™¸ë¶€ ë°ì´í„°ë¥¼ ì•…ìš©í•˜ì§€ ëª»í•˜ê²Œ í•˜ê¸° ìœ„í•œ ì œí•œì…ë‹ˆë‹¤.

#### 5. CSS Shapes
- [CSS Shapes](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_shapes){:target="_blank"}ëŠ” ì½˜í…ì¸ ë¥¼ íŠ¹ì • í˜•íƒœë¡œ ê°ì‹¸ê±°ë‚˜ Clipping(ì˜ë¼ë‚´ê¸°)í•˜ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.
- ì™¸ë¶€ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ëŸ¬í•œ í˜•íƒœë¥¼ ì •ì˜í•˜ë ¤ë©´ ì´ë¯¸ì§€ê°€ ë¡œë“œë˜ëŠ” ì„œë²„ì— CORS í—¤ë”ê°€ í•„ìš”í•©ë‹ˆë‹¤.
- CORSê°€ ì„¤ì •ë˜ì§€ ì•Šìœ¼ë©´ ì™¸ë¶€ ì´ë¯¸ì§€ë¥¼ CSS Shapesì— ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

## CORS ë™ì‘ ë°©ì‹

### Simple Requests(ë‹¨ìˆœ ìš”ì²­)
**Simple Request(ë‹¨ìˆœ ìš”ì²­)** ì€ CORSì—ì„œ Preflight Request(ì‚¬ì „ ìš”ì²­) `OPTIONS`ì„ íŠ¸ë¦¬ê±°í•˜ì§€ ì•ŠëŠ” ìš”ì²­ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.  
ì´ ìš”ì²­ì€ íŠ¹ì • ì¡°ê±´ì„ ì¶©ì¡±í•´ì•¼ í•˜ë©°, ì„œë²„ê°€ CORS ê´€ë ¨ í—¤ë”(Access-Control-Allow-Origin)ë¡œ ì‘ë‹µí•˜ë©´ ë¸Œë¼ìš°ì €ê°€ ì´ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤.  

`Simple Requests`ë¼ëŠ” ìš©ì–´ëŠ” ê³¼ê±° [CORS ìŠ¤í™ì´ˆê¸°](https://www.w3.org/TR/2014/REC-cors-20140116/#simple-cross-origin-request-0){:target="_blank"}ì—ëŠ” ì‚¬ìš©í–ˆì§€ë§Œ í˜„ì¬ CORSë¥¼ ì •ì˜í•˜ê³  ìˆëŠ” [fetch ìŠ¤í™](https://fetch.spec.whatwg.org/){:target="_blank"}ì—ëŠ” ì‚¬ìš©ë˜ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.  

> ğŸ’¡ ì™œ "Simple Requests(ë‹¨ìˆœ ìš”ì²­)"ìš©ì–´ë¥¼ í˜„ì¬ ê³µì‹ì ìœ¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šì„ê¹Œìš”?
>    - ë‹¨ìˆœ ìš”ì²­ì´ë¼ëŠ” í‘œí˜„ì€ ì‚¬ëŒë“¤ì´ CORSì˜ ë™ì‘ ë°©ì‹ì„ ì˜ëª» ì´í•´í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
>    - ì˜ˆë¥¼ ë“¤ì–´, "ë‹¨ìˆœ ìš”ì²­ì€ CORSì™€ ë¬´ê´€í•˜ë‹¤"ë¼ê³  ì˜¤í•´í•  ìˆ˜ ìˆëŠ”ë°, ì‚¬ì‹¤ì€ ì—¬ì „íˆ CORS ì •ì±…ì˜ ì˜í–¥ì„ ë°›ìœ¼ë©°, ì„œë²„ê°€ `Access-Control-Allow-Origin` í—¤ë”ë¥¼ ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´ ë¸Œë¼ìš°ì €ëŠ” ìŠ¤í¬ë¦½íŠ¸ê°€ ì‘ë‹µ ë°ì´í„°ì— ì ‘ê·¼í•˜ì§€ ëª»í•˜ê²Œ í•©ë‹ˆë‹¤.


#### Simple Request(ë‹¨ìˆœ ìš”ì²­) ì¡°ê±´
Simple Request(ë‹¨ìˆœ ìš”ì²­)ëŠ” ì¼ë°˜ì ìœ¼ë¡œ ë‹¤ìŒ ì¡°ê±´ì„ ëª¨ë‘ ì¶©ì¡±í•´ì•¼ í•©ë‹ˆë‹¤.  
*(ë¸Œë¼ìš°ì €ë§ˆë‹¤ ì¶”ê°€ ì œí•œ ì‚¬í•­ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)*  

##### 1. í—ˆìš©ëœ HTTP ë©”ì„œë“œ
ë‹¨ìˆœ ìš”ì²­ì€ ì•„ë˜ì˜ ì„¸ ê°€ì§€ ë©”ì„œë“œ ì¤‘ í•˜ë‚˜ì—¬ì•¼ í•©ë‹ˆë‹¤
- **`GET`**
- **`HEAD`**
- **`POST`**

**ì˜ˆì‹œ ì½”ë“œ**
  
```javascript
fetch("https://hajeonghun.com/api/data", {
  method: "GET", // í—ˆìš©ëœ ë©”ì„œë“œ
});
```
ë§Œì•½ `PUT`, `DELETE` ë“±ì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤ë©´ Preflight Request(ì‚¬ì „ ìš”ì²­)ì´ íŠ¸ë¦¬ê±°ë©ë‹ˆë‹¤.

##### 2. í—ˆìš©ëœ ìš”ì²­ í—¤ë”
ë‹¨ìˆœ ìš”ì²­ì—ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ [CORS-safelisted request-header](https://fetch.spec.whatwg.org/#cors-safelisted-request-header){:target="_blank"}ë§Œ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- **`Accept`**
- **`Accept-Language`**
- **`Content-Language`**
- **`Content-Type`** (ì¶”ê°€ ì¡°ê±´ ìˆìŒ, ì•„ë˜ ì°¸ê³ )
- **`Range`** (ë‹¨, íŠ¹ì • í˜•ì‹ì˜ ê°’ì´ì–´ì•¼ í•¨, ì˜ˆ: `bytes=256-` ë˜ëŠ” `bytes=127-255`)

ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ì¶”ê°€í•˜ëŠ” ê¸°ë³¸ í—¤ë”(`User-Agent`, `Connection` ë“±)ëŠ” í—ˆìš© ì—¬ë¶€ì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

**ì˜ˆì‹œ ì½”ë“œ**

```javascript
fetch("https://hajeonghun.com/api/data", {
  method: "POST",
  headers: {
    "Accept-Language": "en-US", // í—ˆìš©ëœ í—¤ë”
    "Content-Type": "application/x-www-form-urlencoded", // í—ˆìš©ëœ Content-Type
  },
});
```
ë§Œì•½ `Authorization` ê°™ì€ ì‚¬ìš©ì ì •ì˜ í—¤ë”ë¥¼ ì¶”ê°€í•˜ë©´ ì‚¬ì „ ìš”ì²­ì´ í•„ìš”í•©ë‹ˆë‹¤.  

##### 3. Content-Type í—¤ë”ì˜ ì¶”ê°€ ì¡°ê±´
ë‹¨ìˆœ ìš”ì²­ì—ì„œ `Content-Type` í—¤ë”ë¥¼ ì‚¬ìš©í•  ê²½ìš°, ì•„ë˜ì˜ MIME íƒ€ì…ë§Œ í—ˆìš©ë©ë‹ˆë‹¤:
- **`application/x-www-form-urlencoded`**: ì£¼ë¡œ HTML `<form>` ë°ì´í„° ì „ì†¡ì— ì‚¬ìš©.
- **`multipart/form-data`**: íŒŒì¼ ì—…ë¡œë“œ ì‹œ ì‚¬ìš©.
- **`text/plain`**: ì¼ë°˜ í…ìŠ¤íŠ¸ ì „ì†¡.

**ì˜ˆì‹œ ì½”ë“œ(í—ˆìš©ëœ Content-Type)**  
ì•„ë˜ëŠ” ë‹¨ìˆœ ìš”ì²­ìœ¼ë¡œ ê°„ì£¼ë˜ëŠ” ê²½ìš° ì…ë‹ˆë‹¤.

```javascript
fetch("https://hajeonghun.com/api/data", {
  method: "POST",
  headers: {
    "Content-Type": "application/x-www-form-urlencoded", // í—ˆìš©ëœ MIME íƒ€ì…
  },
  body: "name=John&age=30",
});
```

**ì˜ˆì‹œ ì½”ë“œ(í—ˆìš©ë˜ì§€ ì•Šì€ Content-Type)**  
`Content-Type: application/json` ê°™ì€ ê°’ì€ ë‹¨ìˆœ ìš”ì²­ì´ ì•„ë‹ˆë©°, ì‚¬ì „ ìš”ì²­ì„ í•„ìš”ë¡œ í•©ë‹ˆë‹¤.

```javascript
fetch("https://hajeonghun.com/api/data", {
  method: "POST",
  headers: {
    "Content-Type": "application/json", // ì‚¬ì „ ìš”ì²­ íŠ¸ë¦¬ê±°
  },
});
```

##### 4. XMLHttpRequest.upload ê°ì²´ì˜ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
XMLHttpRequest ê°ì²´ë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ, xhr.upload ê°ì²´ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ë“±ë¡í•˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤.  

**ì˜ˆì‹œ ì½”ë“œ(í—ˆìš©ë˜ëŠ” ê²½ìš°)**

```javascript
const xhr = new XMLHttpRequest();
xhr.open("POST", "https://hajeonghun.com/api/data", true);
xhr.send("name=Ha&age=30");
```
![Image](https://github.com/user-attachments/assets/e045de29-b7eb-438f-8837-89f9c2503599)  

**ì˜ˆì‹œ ì½”ë“œ(í—ˆìš©ë˜ì§€ ì•ŠëŠ” ê²½ìš°)**

```javascript
const xhr = new XMLHttpRequest();
xhr.open("POST", "https://hajeonghun.com/api/data", true);

// `xhr.upload`ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì¶”ê°€í•˜ë©´ ì‚¬ì „ ìš”ì²­ì´ íŠ¸ë¦¬ê±° ë¨
xhr.upload.addEventListener("progress", (e) => {
  console.log("progress: ", e.loaded);
});
xhr.send("name=Ha&age=30");
```
![Image](https://github.com/user-attachments/assets/2ce13cba-4c65-43e4-9de4-f2b9164daf99)  

#### ì˜ˆì œ 1 - Simple Request(CORS í—ˆìš©)
[GitHub Exampel Code - Simple Request(CORS í—ˆìš©)](https://github.com/hajeonghun/cors/tree/main/example1)  

![Image](https://github.com/user-attachments/assets/99d44833-7e1d-43bf-a558-6bebde57a549)

```javascript
// server
app.use(cors()); // CORS ì„¤ì • (ëª¨ë“  ë„ë©”ì¸ í—ˆìš©)

// client
const res = await fetch('http://localhost:3000/api/data');
const data = await res.json();
```

- **Request Header**

```http request
GET /api/data HTTP/1.1
Accept: */*
Accept-Encoding: gzip, deflate, br, zstd
Accept-Language: ko-KR,ko;q=0.9,en-US;q=0.8,en;q=0.7
Cache-Control: no-cache
Connection: keep-alive
Host: localhost:3000
Origin: http://localhost:63342
Pragma: no-cache
Referer: http://localhost:63342/
Sec-Fetch-Dest: empty
Sec-Fetch-Mode: cors
Sec-Fetch-Site: same-site
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36
sec-ch-ua: "Google Chrome";v="131", "Chromium";v="131", "Not_A Brand";v="24"
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: "macOS"
```

í´ë¼ì´ì–¸íŠ¸(port: 63342)ì—ì„œ ë‹¤ë¥¸ ì¶œì²˜ì˜ ì„œë²„(port: 3000)ë¡œ ìš”ì²­ ì‹œ í—¤ë”ì— Origin ì„ í¬í•¨í•˜ì—¬ í˜„ì¬ ìš”ì²­ì˜ ì¶œì²˜ë¥¼ ë°í™ë‹ˆë‹¤.

- **Response Header**

```http request
HTTP/1.1 200 OK
X-Powered-By: Express
Access-Control-Allow-Origin: *
Content-Type: application/json; charset=utf-8
Content-Length: 54
ETag: W/"36-MVOqRDG61kU8vexdwYFRo8aCLRc"
Date: Fri, 24 Jan 2025 04:10:09 GMT
Connection: keep-alive
Keep-Alive: timeout=5
```

ì„œë²„ì—ì„œ ì‘ë‹µë°›ì€ í—¤ë”ë¥¼ ì‚´í´ë³´ë©´ `Access-Control-Allow-Origin: *` ê°€ ìˆìŠµë‹ˆë‹¤.  
ì—¬ê¸°ì„œ ì™€ì¼ë“œì¹´ë“œ(*)ì˜ ì˜ë¯¸ëŠ” ëª¨ë“  ì¶œì²˜ì—ì„œ ì ‘ê·¼ì„ í—ˆìš©í•œë‹¤ëŠ” ëœ»ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ëŠ” ì„œë²„ì™€ ì¶œì²˜ê°€ ë‹¤ë¦„ì—ë„ ì •ìƒì ì¸ ì‘ë‹µ ê°’ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- **ì‘ë‹µ ê°’ ì‚¬ìš©**

![Image](https://github.com/user-attachments/assets/e7356aeb-549d-49bc-a925-4ddd0e89dcf6)
