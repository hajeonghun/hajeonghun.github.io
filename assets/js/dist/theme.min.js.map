{"version":3,"file":"theme.min.js","sources":["../../../_javascript/modules/theme.js"],"sourcesContent":["/**\n * Theme management class\n *\n * To reduce flickering during page load, this script should be loaded synchronously.\n */\nclass Theme {\n  static #modeKey = 'mode';\n  static #modeAttr = 'data-mode';\n  static #darkMedia = window.matchMedia('(prefers-color-scheme: dark)');\n  static switchable = !document.documentElement.hasAttribute(this.#modeAttr);\n\n  static get DARK() {\n    return 'dark';\n  }\n\n  static get LIGHT() {\n    return 'light';\n  }\n\n  /**\n   * @returns {string} Theme mode identifier\n   */\n  static get ID() {\n    return 'theme-mode';\n  }\n\n  /**\n   * Gets the current visual state of the theme.\n   *\n   * @returns {string} The current visual state, either the mode if it exists,\n   *                   or the system dark mode state ('dark' or 'light').\n   */\n  static get visualState() {\n    if (this.#hasMode) {\n      return this.#mode;\n    } else {\n      return this.#sysDark ? this.DARK : this.LIGHT;\n    }\n  }\n\n  static get #mode() {\n    return sessionStorage.getItem(this.#modeKey);\n  }\n\n  static get #isDarkMode() {\n    return this.#mode === this.DARK;\n  }\n\n  static get #hasMode() {\n    return this.#mode !== null;\n  }\n\n  static get #sysDark() {\n    return this.#darkMedia.matches;\n  }\n\n  /**\n   * Maps theme modes to provided values\n   * @param {string} light Value for light mode\n   * @param {string} dark Value for dark mode\n   * @returns {Object} Mapped values\n   */\n  static getThemeMapper(light, dark) {\n    return {\n      [this.LIGHT]: light,\n      [this.DARK]: dark\n    };\n  }\n\n  /**\n   * Initializes the theme based on system preferences or stored mode\n   */\n  static init() {\n    if (!this.switchable) {\n      return;\n    }\n\n    this.#darkMedia.addEventListener('change', () => {\n      const lastMode = this.#mode;\n      this.#clearMode();\n\n      if (lastMode !== this.visualState) {\n        this.#notify();\n      }\n    });\n\n    if (!this.#hasMode) {\n      return;\n    }\n\n    if (this.#isDarkMode) {\n      this.#setDark();\n    } else {\n      this.#setLight();\n    }\n  }\n\n  /**\n   * Flips the current theme mode\n   */\n  static flip() {\n    if (this.#hasMode) {\n      this.#clearMode();\n    } else {\n      this.#sysDark ? this.#setLight() : this.#setDark();\n    }\n    this.#notify();\n  }\n\n  static #setDark() {\n    document.documentElement.setAttribute(this.#modeAttr, this.DARK);\n    sessionStorage.setItem(this.#modeKey, this.DARK);\n  }\n\n  static #setLight() {\n    document.documentElement.setAttribute(this.#modeAttr, this.LIGHT);\n    sessionStorage.setItem(this.#modeKey, this.LIGHT);\n  }\n\n  static #clearMode() {\n    document.documentElement.removeAttribute(this.#modeAttr);\n    sessionStorage.removeItem(this.#modeKey);\n  }\n\n  /**\n   * Notifies other plugins that the theme mode has changed\n   */\n  static #notify() {\n    window.postMessage({ id: this.ID }, '*');\n  }\n}\n\nTheme.init();\n\nexport default Theme;\n"],"names":["Theme","DARK","LIGHT","ID","visualState","_classPrivateGetter","_get_hasMode","_get_mode","_get_sysDark","getThemeMapper","light","dark","init","switchable","_assertClassBrand","_darkMedia","_","addEventListener","lastMode","_clearMode","call","_notify","_get_isDarkMode","_setDark","_setLight","flip","_Theme","_this","sessionStorage","getItem","_modeKey","_this2","_this3","_this4","matches","document","documentElement","setAttribute","_modeAttr","setItem","removeAttribute","removeItem","window","postMessage","id","matchMedia","_defineProperty","hasAttribute"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EACA;EACA;EACA;EACA;EACA,MAAMA,KAAK,CAAC;IAMV,WAAWC,IAAIA,GAAG;EAChB,IAAA,OAAO,MAAM;EACf;IAEA,WAAWC,KAAKA,GAAG;EACjB,IAAA,OAAO,OAAO;EAChB;;EAEA;EACF;EACA;IACE,WAAWC,EAAEA,GAAG;EACd,IAAA,OAAO,YAAY;EACrB;;EAEA;EACF;EACA;EACA;EACA;EACA;IACE,WAAWC,WAAWA,GAAG;MACvB,IAAIC,mBAAA,CA5BFL,KAAK,EA4BH,IAAI,EAACM,YAAO,CAAC,EAAE;EACjB,MAAA,OAAOD,mBAAA,CA7BPL,KAAK,EA6BE,IAAI,EAACO,SAAI,CAAC;EACnB,KAAC,MAAM;EACL,MAAA,OAAOF,mBAAA,CA/BPL,KAAK,EA+BE,IAAI,EAACQ,YAAO,CAAC,GAAG,IAAI,CAACP,IAAI,GAAG,IAAI,CAACC,KAAK;EAC/C;EACF;EAkBA;EACF;EACA;EACA;EACA;EACA;EACE,EAAA,OAAOO,cAAcA,CAACC,KAAK,EAAEC,IAAI,EAAE;MACjC,OAAO;EACL,MAAA,CAAC,IAAI,CAACT,KAAK,GAAGQ,KAAK;QACnB,CAAC,IAAI,CAACT,IAAI,GAAGU;OACd;EACH;;EAEA;EACF;EACA;IACE,OAAOC,IAAIA,GAAG;EACZ,IAAA,IAAI,CAAC,IAAI,CAACC,UAAU,EAAE;EACpB,MAAA;EACF;EAEAC,IAAAA,iBAAA,CAxEEd,KAAK,EAwEP,IAAI,EAACe,UAAU,CAAAC,CAAAA,CAAA,CAACC,gBAAgB,CAAC,QAAQ,EAAE,MAAM;QAC/C,MAAMC,QAAQ,GAAGb,mBAAA,CAzEjBL,KAAK,EAyEY,IAAI,EAACO,SAAI,CAAC;QAC3BO,iBAAA,CA1EAd,KAAK,EA0EL,IAAI,EAACmB,UAAS,CAAC,CAAAC,IAAA,CAAf,IAAI,CAAA;EAEJ,MAAA,IAAIF,QAAQ,KAAK,IAAI,CAACd,WAAW,EAAE;UACjCU,iBAAA,CA7EFd,KAAK,EA6EH,IAAI,EAACqB,OAAM,CAAC,CAAAD,IAAA,CAAZ,IAAI,CAAA;EACN;EACF,KAAC,CAAC;MAEF,IAAI,CAACf,mBAAA,CAjFHL,KAAK,EAiFF,IAAI,EAACM,YAAO,CAAC,EAAE;EAClB,MAAA;EACF;MAEA,IAAID,mBAAA,CArFFL,KAAK,EAqFH,IAAI,EAACsB,eAAU,CAAC,EAAE;QACpBR,iBAAA,CAtFAd,KAAK,EAsFL,IAAI,EAACuB,QAAO,CAAC,CAAAH,IAAA,CAAb,IAAI,CAAA;EACN,KAAC,MAAM;QACLN,iBAAA,CAxFAd,KAAK,EAwFL,IAAI,EAACwB,SAAQ,CAAC,CAAAJ,IAAA,CAAd,IAAI,CAAA;EACN;EACF;;EAEA;EACF;EACA;IACE,OAAOK,IAAIA,GAAG;MACZ,IAAIpB,mBAAA,CAhGFL,KAAK,EAgGH,IAAI,EAACM,YAAO,CAAC,EAAE;QACjBQ,iBAAA,CAjGAd,KAAK,EAiGL,IAAI,EAACmB,UAAS,CAAC,CAAAC,IAAA,CAAf,IAAI,CAAA;EACN,KAAC,MAAM;EACLf,MAAAA,mBAAA,CAnGAL,KAAK,EAmGL,IAAI,EAACQ,YAAO,CAAC,GAAGM,iBAAA,CAnGhBd,KAAK,EAmGW,IAAI,EAACwB,SAAQ,CAAC,CAAAJ,IAAA,CAAd,IAAI,CAAeN,GAAAA,iBAAA,CAnGnCd,KAAK,EAmG8B,IAAI,EAACuB,QAAO,CAAC,CAAAH,IAAA,CAAb,IAAI,CAAW;EACpD;MACAN,iBAAA,CArGEd,KAAK,EAqGP,IAAI,EAACqB,OAAM,CAAC,CAAAD,IAAA,CAAZ,IAAI,CAAA;EACN;EAuBF;EAACM,MAAA,GA7HK1B,KAAK;EAAA,SAAAO,SAAAA,CAAAoB,KAAA,EAmCU;EACjB,EAAA,OAAOC,cAAc,CAACC,OAAO,CAACf,iBAAA,CApC5Bd,MAAK,EAAA2B,KAAA,EAoC4BG,QAAQ,CAAA,CAAAd,CAAA,CAAC;EAC9C;EAAC,SAAAM,eAAAA,CAAAS,MAAA,EAEwB;IACvB,OAAO1B,mBAAA,CAxCLL,MAAK,EAAA+B,MAAA,EAwCKxB,SAAI,CAAC,KAAKwB,MAAA,CAAK9B,IAAI;EACjC;EAAC,SAAAK,YAAAA,CAAA0B,MAAA,EAEqB;IACpB,OAAO3B,mBAAA,CA5CLL,MAAK,EAAAgC,MAAA,EA4CKzB,SAAI,CAAC,KAAK,IAAI;EAC5B;EAAC,SAAAC,YAAAA,CAAAyB,MAAA,EAEqB;IACpB,OAAOnB,iBAAA,CAhDLd,MAAK,EAAAiC,MAAA,EAgDKlB,UAAU,CAAA,CAAAC,CAAA,CAACkB,OAAO;EAChC;EAAC,SAAAX,WAuDiB;EAChBY,EAAAA,QAAQ,CAACC,eAAe,CAACC,YAAY,CAACvB,iBAAA,CAzGpCd,MAAK,EAyG+B,IAAI,EAACsC,SAAS,CAAAtB,CAAAA,CAAA,EAAE,IAAI,CAACf,IAAI,CAAC;EAChE2B,EAAAA,cAAc,CAACW,OAAO,CAACzB,iBAAA,CA1GrBd,MAAK,EA0GgB,IAAI,EAAC8B,QAAQ,EAAAd,CAAA,EAAE,IAAI,CAACf,IAAI,CAAC;EAClD;EAAC,SAAAuB,YAEkB;EACjBW,EAAAA,QAAQ,CAACC,eAAe,CAACC,YAAY,CAACvB,iBAAA,CA9GpCd,MAAK,EA8G+B,IAAI,EAACsC,SAAS,CAAAtB,CAAAA,CAAA,EAAE,IAAI,CAACd,KAAK,CAAC;EACjE0B,EAAAA,cAAc,CAACW,OAAO,CAACzB,iBAAA,CA/GrBd,MAAK,EA+GgB,IAAI,EAAC8B,QAAQ,EAAAd,CAAA,EAAE,IAAI,CAACd,KAAK,CAAC;EACnD;EAAC,SAAAiB,aAEmB;EAClBgB,EAAAA,QAAQ,CAACC,eAAe,CAACI,eAAe,CAAC1B,iBAAA,CAnHvCd,MAAK,EAmHkC,IAAI,EAACsC,SAAS,CAAA,CAAAtB,CAAA,CAAC;EACxDY,EAAAA,cAAc,CAACa,UAAU,CAAC3B,iBAAA,CApHxBd,MAAK,EAoHmB,IAAI,EAAC8B,QAAQ,CAAAd,CAAAA,CAAA,CAAC;EAC1C;EAEA;EACF;EACA;EAFE,SAAAK,UAGiB;IACfqB,MAAM,CAACC,WAAW,CAAC;MAAEC,EAAE,EAAE,IAAI,CAACzC;KAAI,EAAE,GAAG,CAAC;EAC1C;EAAC,IAAA2B,QAAA,GAAA;EAAAd,EAAAA,CAAA,EA3HiB;EAAM,CAAA;EAAA,IAAAsB,SAAA,GAAA;EAAAtB,EAAAA,CAAA,EACL;EAAW,CAAA;EAAA,IAAAD,UAAA,GAAA;EAAAC,EAAAA,CAAA,EACV0B,MAAM,CAACG,UAAU,CAAC,8BAA8B;EAAC,CAAA;EAAAC,eAAA,CAHjE9C,KAAK,EAAA,YAAA,EAIW,CAACmC,QAAQ,CAACC,eAAe,CAACW,YAAY,CAACjC,iBAAA,CAJvDd,MAAK,EAAA0B,MAAA,EAIuDY,SAAS,CAAA,CAAAtB,CAAA,CAAC,CAAA;EA2H5EhB,KAAK,CAACY,IAAI,EAAE;;;;;;;;"}